<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instax Wide Photo Printer - 4x6 Layout</title>
    <style>
        /* Base and Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            line-height: 1.5;
            background-color: #e9e9e9; /* Light gray background for the page "outside" the print area */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem; /* Padding around the content */
            min-height: 100vh;
        }

        .controls-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 500px;
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        p {
            color: #555;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .dimensions-info {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 1.5rem;
        }

        .btn {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-print {
            background: #2ecc71;
            margin-top: 1rem;
        }
        .btn-print:hover {
            background: #27ae60;
        }
        #imageUpload {
            display: none; /* Hidden file input */
        }

        #previewArea {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #uploadPromptText {
            text-align: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: #777;
        }

        /* New Paper Sheet Container */
        .paper-sheet {
            position: relative; /* For absolute positioning of children */
            width: 152.4mm;  /* 6 inches */
            height: 101.6mm; /* 4 inches */
            margin: 20px auto; /* Center the paper on the screen for preview */
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Visual lift for the paper */
            display: none; /* Initially hidden, JS will show it */
            overflow: hidden; /* Ensures nothing spills out */
        }

        /* Base .instax-container styles (will be mostly overridden when inside .paper-sheet) */
        .instax-container {
            width: 108mm; /* Instax Wide width */
            height: 84mm; /* Instax Wide height (as per your consistent CSS) */
            position: relative; /* Default, overridden below */
            margin: 20px auto; /* Default, overridden below */
            display: none; /* Default, JS controls this */
            /* background-color: white; /* instax-frame handles this */
            /* box-shadow: 0 6px 15px rgba(0,0,0,0.1); /* Default, overridden below */
        }
        
        /* Adjustments for .instax-container when inside .paper-sheet */
        .paper-sheet .instax-container {
            position: absolute;
            top: 8.8mm;   /* (Paper Height - Instax Height) / 2 */
            left: 22.2mm;  /* (Paper Width - Instax Width) / 2 */
            box-shadow: none; /* Shadow is now on .paper-sheet */
            margin: 0; /* Override previous auto margins */
            background-color: transparent; /* Ensure no conflicting background */
             /* display: block; /* JS will handle making this visible when paper-sheet is visible */
        }

        /* Styles for .instax-frame remain largely the same */
        .instax-frame {
            width: 100%;
            height: 100%;
            background-color: white; /* The actual white border of the Instax print */
            padding: 8mm 5mm 16mm 5mm; /* T R B L -> Photo area: H (84-8-16)=60mm, W (108-5-5)=98mm */
            border-radius: 0; /* Approx rounded corners of an Instax print */
            display: flex; /* For centering image-inside if needed, though object-fit handles it */
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Image clipped to photo area defined by padding */
            /*border: 1px dashed #aaa; /* Dashed border for the frame itself */
        }

        .image-inside {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the photo area, cropping if necessary */
            display: block;
            background-color: #e0e0e0; /* Placeholder bg before image loads */
        }

        /* Hide OLD L-shaped trim marks if they still exist in HTML (safeguard) */
        .instax-container > .trim-mark {
            display: none !important;
        }

        /* New Extended Trim Marks for 4x6 paper */
        .extended-trim-mark {
            position: absolute;
            background-color: transparent; /* Color for on-screen preview */
            z-index: 5; /* Can be adjusted if needed */
        }
        .top-guide {
            top: 8.8mm; /* Align with top edge of Instax print */
            left: 0;
            width: 100%; /* Full width of paper */
            height: 0.5px; /* Thin line */
            border-top: 1px dashed #000000; /* Dashed line, screen color */
        }
        .bottom-guide {
            bottom: 8.8mm; /* Align with bottom edge of Instax print */
            left: 0;
            width: 100%; /* Full width of paper */
            height: 0.5px;
            border-bottom: 1px dashed #000000; /* Dashed line, screen color */
        }
        .left-guide {
            left: 22.2mm; /* Align with left edge of Instax print */
            top: 0;
            height: 100%; /* Full height of paper */
            width: 0.5px;
            border-left: 1px dashed #000000; /* Dashed line, screen color */
        }
        .right-guide {
            right: 22.2mm; /* Align with right edge of Instax print */
            top: 0;
            height: 100%; /* Full height of paper */
            width: 0.5px;
            border-right: 1px dashed #000000; /* Dashed line, screen color */
        }


        /* Print Styles */
        @media print {
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .controls-container, #printButton, #uploadPromptText {
                display: none !important;
            }

            @page {
                margin: 0;
                size: auto; /* Let user choose paper, or try '6in 4in' if you want to suggest it */
            }

            #previewArea { /* This flex container will center the .paper-sheet on the print page */
                width: 100vw;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding:0; margin:0;
            }

            .paper-sheet {
                display: block !important; /* Ensure it's visible for printing */
                position: relative; /* Maintain for child positioning */
                margin: 0 !important; /* Centering handled by #previewArea flex */
                box-shadow: none !important;
                page-break-inside: avoid !important;
                /* Width and height (152.4mm x 101.6mm) are already set */
            }

            .paper-sheet .instax-container { /* Ensure instax-container inside paper is visible */
                display: block !important; 
                /* Absolute positioning within .paper-sheet is already defined */
            }

            .instax-frame {
                /*border: 1px dashed #aaa !important; /* Keep dashed border on frame for print */
            }

            .extended-trim-mark {
                background-color: transparent !important; /* Trim marks should be black for print */
                /* Consider using 1px for height/width if 0.5px is too faint on some printers */
                 /* height: 1px; or width: 1px; */
            }

            .image-inside {
                 background-color: transparent !important; /* No placeholder bg color on print */
            }

            .top-guide {
                border-top: 1px dashed #000000 !important;
            }
            .bottom-guide {
                border-bottom: 1px dashed #000000 !important;
            }
            .left-guide {
                border-left: 1px dashed #000000 !important;
            }
            .right-guide {
                border-right: 1px dashed #000000 !important;
            }
        }
    </style>
</head>
<body>
    <div class="controls-container">
        <h1>Instax Wide Photo Printer</h1>
        <p>Upload your photo. It will be centered on a 4x6 inch layout with trim marks.</p>
        <p class="dimensions-info">
            Paper: 4in × 6in. Instax Frame (Outer): 84mm × 108mm.<br>
            Photo Area (approx): 60mm × 98mm.
        </p>

        <label for="imageUpload" class="btn">
            Upload Image
        </label>
        <input type="file" id="imageUpload" accept="image/*">

        <button id="printButton" class="btn btn-print" style="display: none;">
            Print 4x6 Layout
        </button>
    </div>

    <div id="previewArea">
        <p id="uploadPromptText">Your photo preview will appear here.</p>

        <div class="paper-sheet"> <div class="extended-trim-mark top-guide"></div>
            <div class="extended-trim-mark bottom-guide"></div>
            <div class="extended-trim-mark left-guide"></div>
            <div class="extended-trim-mark right-guide"></div>

            <div class="instax-container"> <div class="instax-frame">
                    <img id="imagePreview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Image Preview" class="image-inside">
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const paperSheet = document.querySelector('.paper-sheet');
            const instaxContainer = document.querySelector('.paper-sheet .instax-container'); // More specific selector
            const printButton = document.getElementById('printButton');
            const uploadPromptText = document.getElementById('uploadPromptText');

            imageUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.backgroundColor = 'transparent';

                        paperSheet.style.display = 'block';
                        instaxContainer.style.display = 'block'; // Ensure this is explicitly shown

                        uploadPromptText.style.display = 'none';
                        printButton.style.display = 'inline-block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
                    imagePreview.style.backgroundColor = '#e0e0e0';
                    
                    if (file) { // Invalid file type
                        uploadPromptText.textContent = "Invalid file. Please select an image (e.g., JPG, PNG).";
                        uploadPromptText.style.color = "#e74c3c"; // Error color
                    } else { // No file selected or dialog cancelled
                        uploadPromptText.textContent = "Your photo preview will appear here.";
                        uploadPromptText.style.color = "#777"; // Default color
                    }
                    uploadPromptText.style.display = 'block';
                    paperSheet.style.display = 'none';
                    instaxContainer.style.display = 'none'; // Also hide this explicitly
                    printButton.style.display = 'none';
                }
            });

            printButton.addEventListener('click', () => {
                const originalTitle = document.title;
                const filenameBase = "Instax_Print_4x6";
                let filename = filenameBase;
                if (imageUpload.files[0] && imageUpload.files[0].name) {
                    const uploadedName = imageUpload.files[0].name.split('.')[0];
                    filename = uploadedName + "_4x6_Layout";
                }
                document.title = filename.replace(/[^a-z0-9_]+/gi, '_') + "_" + new Date().toISOString().slice(0,10);
                
                window.print();
                
                // Optional: Restore title after print dialog
                // setTimeout(() => { document.title = originalTitle; }, 2000);
            });
        });
    </script>
</body>
</html>
