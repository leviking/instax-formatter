<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instax Wide Photo Printer - 4x6 Layout with Caption</title>
    <style>
        /* Base and Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            line-height: 1.5;
            background-color: #e9e9e9;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            min-height: 100vh;
        }

        .controls-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 500px;
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        p {
            color: #555;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .dimensions-info {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 1.5rem;
        }

        .btn {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-print {
            background: #2ecc71;
            margin-top: 1rem; /* Will be after caption input */
        }
        .btn-print:hover {
            background: #27ae60;
        }
        #imageUpload {
            display: none;
        }

        #previewArea {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #uploadPromptText {
            text-align: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: #777;
        }

        .paper-sheet {
            position: relative;
            width: 152.4mm;  /* 6 inches */
            height: 101.6mm; /* 4 inches */
            margin: 20px auto;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
            overflow: hidden;
        }

        .instax-container { /* Base styles, mostly overridden when inside .paper-sheet */
            width: 108mm;
            height: 84mm;
            position: relative;
            margin: 20px auto; /* For standalone display if not in paper-sheet */
            display: none;
        }
        
        .paper-sheet .instax-container { /* Styles when Instax is inside the paper */
            position: absolute;
            top: 8.8mm;   /* (Paper Height - Instax Height) / 2 */
            left: 22.2mm;  /* (Paper Width - Instax Width) / 2 */
            box-shadow: none;
            margin: 0;
            background-color: transparent;
        }

        .instax-frame {
            width: 100%;
            height: 100%;
            background-color: white;
            padding: 8mm 5mm 16mm 5mm; /* T R B L -> Bottom padding is 16mm */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Clips the image-inside */
            border: 1px dashed #aaa; /* Dashed border for the frame itself */
            position: relative; /* Crucial for positioning the caption absolutely inside it */
        }

        .image-inside {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            background-color: #e0e0e0;
        }
        
        /* Caption Display Styles */
        .instax-caption {
            position: absolute;
            bottom: 2mm;   /* Distance from the bottom edge of the instax-frame's border */
            left: 5mm;     /* Aligns with the left padding of the photo (instax-frame's left padding) */
            right: 5mm;    /* Aligns with the right padding of the photo (instax-frame's right padding) */
            max-height: 12mm; /* Max height for caption: 16mm (padding-bottom) - 2mm (bottom offset) - ~2mm (top margin) */
            font-size: 2.5mm; /* Approx 7pt */
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            color: #333;    /* Caption color on screen */
            line-height: 1.3;
            text-align: left;
            overflow-y: hidden; /* Hides text that overflows max-height */
            word-wrap: break-word; /* Allows long words to break and wrap */
            white-space: pre-wrap; /* Respects newlines from textarea for display */
        }

        /* Hide OLD L-shaped trim marks if they exist as direct children of .instax-container (safeguard) */
        .instax-container > .trim-mark {
            display: none !important;
        }

        /* Extended Trim Marks - Dashed */
        .extended-trim-mark {
            position: absolute;
            z-index: 5;
            background-color: transparent; /* Ensure no background interferes with border */
        }
        .top-guide {
            top: 8.8mm;
            left: 0;
            width: 100%;
            height: 0; 
            border-top: 1px dashed #555;
        }
        .bottom-guide {
            bottom: 8.8mm;
            left: 0;
            width: 100%;
            height: 0;
            border-bottom: 1px dashed #555;
        }
        .left-guide {
            left: 22.2mm;
            top: 0;
            height: 100%;
            width: 0;
            border-left: 1px dashed #555;
        }
        .right-guide {
            right: 22.2mm;
            top: 0;
            height: 100%;
            width: 0;
            border-right: 1px dashed #555;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .controls-container, #printButton, #uploadPromptText, .caption-input-area /* Also hide caption input controls */ {
                display: none !important;
            }

            @page {
                margin: 0;
                size: auto;
            }

            #previewArea {
                width: 100vw;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding:0; margin:0;
            }

            .paper-sheet {
                display: block !important;
                position: relative;
                margin: 0 !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
            }

            .paper-sheet .instax-container {
                display: block !important;
            }

            .instax-frame {
                border: 1px dashed #aaa !important;
            }
            
            .instax-caption {
                color: #000000 !important; /* Ensure caption text is black for print */
                font-size: 2.5mm !important; /* Ensure consistent font size in print */
            }

            .extended-trim-mark {
                /* Border style is inherited, only color needs to be ensured for print */
            }
            .top-guide    { border-top-color: #000000 !important; }
            .bottom-guide { border-bottom-color: #000000 !important; }
            .left-guide   { border-left-color: #000000 !important; }
            .right-guide  { border-right-color: #000000 !important; }
            /* If you wanted to ensure they are dashed for print specifically:
            .top-guide    { border-top-style: dashed !important; }
            .bottom-guide { border-bottom-style: dashed !important; }
            .left-guide   { border-left-style: dashed !important; }
            .right-guide  { border-right-style: dashed !important; }
            */


            .image-inside {
                 background-color: transparent !important;
            }
        }
    </style>
</head>
<body>
    <div class="controls-container">
        <h1>Instax Wide Photo Printer</h1>
        <p>Upload your photo. It will be centered on a 4x6 inch layout with trim marks.</p>
        <p class="dimensions-info">
            Paper: 4in × 6in. Instax Frame (Outer): 84mm × 108mm.<br>
            Photo Area (approx): 60mm × 98mm.
        </p>

        <label for="imageUpload" class="btn">
            Upload Image
        </label>
        <input type="file" id="imageUpload" accept="image/*">

        <div class="caption-input-area" style="margin-top: 1.5rem; margin-bottom: 1rem; text-align: left;">
            <label for="captionText" style="display:block; margin-bottom:0.35rem; font-weight: 500; font-size:0.9rem; color:#444;">Caption (optional):</label>
            <textarea id="captionText" rows="3" placeholder="Enter your caption here..." style="width: 100%; padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; line-height: 1.4; resize: vertical;"></textarea>
        </div>

        <button id="printButton" class="btn btn-print" style="display: none;">
            Print 4x6 Layout
        </button>
    </div>

    <div id="previewArea">
        <p id="uploadPromptText">Your photo preview will appear here.</p>

        <div class="paper-sheet"> <div class="extended-trim-mark top-guide"></div>
            <div class="extended-trim-mark bottom-guide"></div>
            <div class="extended-trim-mark left-guide"></div>
            <div class="extended-trim-mark right-guide"></div>

            <div class="instax-container">
                <div class="instax-frame">
                    <img id="imagePreview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Image Preview" class="image-inside">
                    <div class="instax-caption"></div> </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const paperSheet = document.querySelector('.paper-sheet');
            const instaxContainer = document.querySelector('.paper-sheet .instax-container');
            const printButton = document.getElementById('printButton');
            const uploadPromptText = document.getElementById('uploadPromptText');

            const captionInput = document.getElementById('captionText');
            const captionDisplay = document.querySelector('.instax-caption');

            captionInput.addEventListener('input', function() {
                captionDisplay.textContent = this.value;
            });

            imageUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.backgroundColor = 'transparent';

                        paperSheet.style.display = 'block';
                        instaxContainer.style.display = 'block'; // Ensure instax-container is also shown

                        // Populate caption from current input value, in case it was typed before image load
                        captionDisplay.textContent = captionInput.value;

                        uploadPromptText.style.display = 'none';
                        printButton.style.display = 'inline-block';
                    };
                    reader.readAsDataURL(file);
                } else { // No file selected, or invalid file
                    imagePreview.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
                    imagePreview.style.backgroundColor = '#e0e0e0';
                    
                    if (file) { // Invalid file type specifically
                        uploadPromptText.textContent = "Invalid file. Please select an image (e.g., JPG, PNG).";
                        uploadPromptText.style.color = "#e74c3c";
                    } else { // Dialog cancelled or no file
                        uploadPromptText.textContent = "Your photo preview will appear here.";
                        uploadPromptText.style.color = "#777";
                    }
                    uploadPromptText.style.display = 'block';
                    paperSheet.style.display = 'none';
                    instaxContainer.style.display = 'none'; // Explicitly hide
                    printButton.style.display = 'none';
                    
                    // Clear caption input and display if image is removed/invalid
                    // captionInput.value = ''; // Keep user's typed text in textarea
                    captionDisplay.textContent = ''; // But clear it from preview
                }
            });

            printButton.addEventListener('click', () => {
                const originalTitle = document.title;
                const filenameBase = "Instax_Print_4x6";
                let filename = filenameBase;
                if (imageUpload.files[0] && imageUpload.files[0].name) {
                    const uploadedName = imageUpload.files[0].name.split('.')[0];
                    filename = uploadedName + "_4x6_Layout";
                }
                // Sanitize filename for document title
                document.title = filename.replace(/[^a-z0-9_.\-\s]/gi, '_').replace(/\s+/g, '_') + "_" + new Date().toISOString().slice(0,10);
                
                window.print();
                
                // Optional: Restore title after print dialog
                // setTimeout(() => { document.title = originalTitle; }, 2000);
            });
        });
    </script>
</body>
</html>
